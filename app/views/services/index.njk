{% extends "../layout.njk" %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}

{% block pageTitle %}
  Choose service - GOV.UK Pay
{% endblock %}

{% block pageSpecificJS %}
  <script src="/public/js/components/notification-banner.js"></script>
{% endblock %}

{% block mainContent %}
  <div class="govuk-grid-column-two-thirds">
    {% if show_whats_new_notification %}
      {% set bannerHtml %}
          <div>
            <ol class="govuk-list govuk-list--number">
              <li>When you log in, you'll land on this page, 'My services'.</li>
              <li>Your live services now appear alphabetically at the beginning of the list.</li>
            </ol>

            <form method="POST" action="{{routes.serviceSwitcher.removeNotification}}">
              <input id="csrf" name="csrfToken" type="hidden" value="{{csrf}}"/>
              {{ govukButton({
                text: "Close",
                classes: "govuk-button--secondary govuk-!-margin-bottom-0",
                type: "submit",
                attributes: {
                  "id": "my-services-whats-new-notification__close-button"
                }
              }) }}
            </form>
          </div>
      {% endset %}

      {{ govukNotificationBanner({
          html: bannerHtml,
          titleText: 'Admin tool changes',
          attributes: {
            id: 'my-services-whats-new-notification'
          }
      }) }}
    {% endif %}

    {% if new_service_name %}
      <div class="govuk-grid-column-full govuk-!-margin-0">
        <div class="flash-container flash-container--good">
          <p id="new-service-name" class="govuk-body govuk-!-margin-bottom-0">You have been added to {{new_service_name}}</p>
        </div>
      </div>
    {% endif %}

    <h1 class="govuk-heading-l govuk-!-margin-bottom-6 service-count">
      {% if services_singular %}
        You have {{services.length}} service
      {% else %}
        You have {{services.length}} services
      {% endif %}
    </h1>

    <p class="govuk-body">
        {{ govukButton({
          classes: "govuk-button--secondary",
          text: "Add a new service",
          href: routes.serviceSwitcher.create
        }) }}
    </p>

    {% set allServiceTransactionsPath = routes.allServiceTransactions.index if has_live_account else routes.formattedPathFor(routes.allServiceTransactions.indexStatusFilter, 'test') %}

    {% if has_live_account or env.ENABLE_TEST_REPORTS === 'true' %}
    <p class="govuk-body">
      <a href="{{ allServiceTransactionsPath }}" class="govuk-link govuk-!-margin-right-3 govuk-link--no-visited-state">
        Show transactions for all your services
      </a>
    </p>
    {% endif %}

    {% set payoutsPath = routes.payouts.list if has_live_account else routes.formattedPathFor(routes.payouts.listStatusFilter, 'test') %}

    {% if has_account_with_payouts %}
      <p class="govuk-body">
        <a href="{{ payoutsPath }}" class="govuk-link govuk-!-margin-right-3 govuk-link--no-visited-state">
          Show payments to your bank account
        </a>
      </p>
    {% endif %}

    {% if services.length > 7 %}
      <div class="js-show flex-grid--row">
        <div class="flex-grid--column-two-thirds tight">
          <label class="govuk-label" for="service-filter">Filter services</label>
          <div id="service-filter-container" class="autocomplete-container"></div>
        </div>
        <div class="flex-grid--column-third tight">
          <button class="govuk-link pay-button--as-link govuk-!-margin-top-7" id="clear-filters">Clear filter</button>
        </div>
      </div>
    {% endif %}

    <div class="flex-grid">
      {% for service in services %}
          {% include "./_service-section.njk" %}
      {% endfor %}
    </div>
  </div>
{% endblock %}
