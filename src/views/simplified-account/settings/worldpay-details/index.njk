{% extends "../settings-layout.njk" %}

{% set settingsPageTitle = "Worldpay details" %}

{% block settingsContent %}
  <h1 class="govuk-heading-l">{{ settingsPageTitle }}</h1>

  {% if incompleteTasks %}
    <p class="govuk-body govuk-!-margin-bottom-6">
      You need to link your Worldpay account to GOV.UK Pay.
    </p>

    {% set taskList = [] %}
    {% for task in tasks %}
      {% if task.status == 'CANNOT_START' %}
        {% set taskStatusTag = {
          tag: {
            text: "Cannot start yet",
            classes: "govuk-tag--grey"
          }
        } %}
      {% elseif task.status == 'COMPLETED' %}
        {% set taskStatusTag = {
          text: "Completed"
        } %}
      {% else %}
        {% set taskStatusTag = {
          tag: {
            text: "Not yet started",
            classes: "govuk-tag--blue"
          }
        } %}
      {% endif %}

      {% set taskList = (taskList.push({
        title: {
          text: task.linkText
        },
        href: task.href if task.status != 'CANNOT_START',
        status: taskStatusTag
      }), taskList) %}
    {% endfor %}

    {{ govukTaskList({
      idPrefix: "worldpay-tasks",
      items: taskList,
      classes: "task-list"
    }) }}

  {% else %}

    {% set taskList = [] %}
    {% for task in tasks %}
      {% set taskCardRows = [] %}
        {% for row in task.completedCard.rows %}
          {% set taskCardRows = (taskCardRows.push({
              key: { text: row.keyText },
              value: { text: row.valueText }
          }), taskCardRows) %}
        {% endfor %}

      {{ govukSummaryList({
        card: {
          title: {
            text: task.completedCard.title
          },
          actions: {
            items: [{
              href: task.href,
              text: 'Change'
            }]
          }
        },
        rows: taskCardRows
      }) }}

    {% endfor %}

  {% endif %}

{% endblock %}
